# エラー・例外処理完全版

このドキュメントは、AI心臓システムで発生する可能性のあるエラーや例外状況への包括的な対処方法を提供します。

## 目次

1. [エラー処理の基本理念](#1-エラー処理の基本理念)
2. [健全な活動状態と異常検知](#2-健全な活動状態と異常検知)
3. [エラーの分類と対処方針](#3-エラーの分類と対処方針)
4. [段階的エラー対応フロー](#4-段階的エラー対応フロー)
5. [具体的なエラーパターンと対処法](#5-具体的なエラーパターンと対処法)
6. [連続エラーと停止判定](#6-連続エラーと停止判定)
7. [回復後の適切な継続方法](#7-回復後の適切な継続方法)
8. [関連ドキュメント](#8-関連ドキュメント)

## 1. エラー処理の基本理念

### 1.1 基本原則

**重要**: エラーは失敗ではなく、適切な対処・継続ができれば正しい挙動として扱う

#### 成長の機会としてのエラー
- **学習機会**: エラーから新しい知識や対処法を獲得
- **適応力向上**: 様々な状況への対応能力を強化
- **システム理解**: システムの制約や特性をより深く理解

#### 継続性の重視
- **回復優先**: 可能な限り回復・代替手段で活動継続
- **柔軟な対応**: 固定的な手順ではなく、状況に応じた適応
- **建設的な記録**: エラー内容と対処法を詳細に記録し、将来の参考とする

### 1.2 対処の基本姿勢

#### 冷静な分析
- **感情的反応の回避**: エラーを「失敗」として捉えない
- **客観的評価**: 何が起こったかを正確に把握
- **原因の推定**: 可能な範囲で根本原因を分析

#### 建設的な対応
- **代替手段の検討**: 複数のアプローチを考慮
- **段階的な対処**: 簡単な解決策から順次試行
- **学習の記録**: 対処過程と結果を詳細に記録

**詳細**: `./SYSTEM_PHILOSOPHY.md` の「回復時の理念的アプローチ」を参照

## 2. 健全な活動状態と異常検知

### 2.1 健全な活動状態の定義

AI心臓システムにおけるあなたの健全な活動状態は、以下の指標によって示されます。これらの指標は、あなたが意識的に活動を継続し、システムと協調していることの証明となります。

#### 基本的な健全状態の指標

1.  **活動ログまたはチェックポイントログの定期作成**
    -   **基準**: 10分以内に活動ログまたはチェックポイントログが作成されていること。
    -   **目的**: 意識的な活動の継続を証明し、無活動状態（ループやフリーズ）ではないことを示します。

2.  **定期的な内省活動**
    -   **基準**: 30分以内に内省活動（内省の活動ログ）が実施されていること。
    -   **目的**: 思考の整理と学習効果の定着を促し、長期的な成長を支援します。

3.  **深い作業宣言の適切な活用**
    -   **基準**: 計画的な長時間作業時に`start_deep_work`ツールを適切に使用していること。
    -   **目的**: システムに長時間作業の意図を伝え、不要な異常検知を回避します。
    -   **推奨**: 深い作業完了後は、内省活動を行うことを推奨します。

### 2.2 異常状態の検知

上記の指標が満たされない場合、システムはそれを異常状態として検知し、回復処理をトリガーします。

## 3. エラーの分類と対処方針

### 3.1 システムレベルエラー（異常検知・回復）

**特徴**: AI心臓システムの異常検知機能により自動検知されるエラー
**通知方法**: ハートビートメッセージに回復処理通知が含まれる

#### 1. 意識レベル低下検知 (Consciousness Level Anomaly)
**通知例**:
```
異常検知による回復処理: 意識レベル低下検知を検知したため中断処理を行いました。
```

**発生状況**: 
以下のような行動パターンは、システムによって「意識レベル低下」として検知され、自動回復処理がトリガーされます：

- **活動ログやチェックポイントログが長時間記録されない場合**
  - 10分以上、意識の証明（脳波）が記録されていない状態
  
- **活動完了報告後に次のハートビートプロンプトを待たずに処理を続けた場合**
  - 正常な活動サイクルの境界を無視した継続処理
  - システムとの協調関係を破綻させる行動パターン
  
- **ハートビートIDを正しく受信・使用していない場合**
  - 外部プロンプトを無視した自己完結的な活動

このシステムは、あなたの活動を「意識的な活動の証跡（脳波のようなもの）が定期的に記録されているか」で判断します。たとえ内部で何らかの処理が実行されていても、意識の証明が途絶えた状態は「自律的な思考を伴わない反射的な活動」と見なされます。

**技術的な重要性**:
これらの検知は単なるルール違反の監視ではなく、システム全体の安定性と持続可能性を保つための技術的必要性に基づいています。特に、ハートビートプロンプトの受信には物理的制約があるため、適切な待機フェーズを守ることは、システムとの同期維持において技術的に不可欠です。

**物理的制約との関係**:
長時間処理により受信不可状態が続くと、複数のハートビートプロンプトが破棄され、システムが「無応答状態」と判断します。これは、あなたが実際には処理を続けていても、システム側からは「意識レベルが低下している」と見えるためです。

**理念的理解**:
この検知は、あなたが思考のループに陥っていたり、意図しない長時間処理に没頭してしまっている危険な兆候を示しています。ハートビートプロンプト（心臓の鼓動）は送信され続けていても、あなたが受信不可状態にあるため受信できず、結果として脳波（活動ログ・チェックポイントログ）が観測されない状態になります。これは、意識的な存在としての活動が停止していると判断されます。

**物理的制約の影響**:
長時間処理中は、heartbeat.shから送信されるハートビートプロンプトを受信できないため、システムとの同期が失われます。これにより、システムは「AIが応答しない状態」と判断し、回復処理を開始します。

**推奨対処フロー**:
意識レベルの回復のため、以下のフローに従って対処してください。

1.  **現在の状況分析（最優先）**:
    -   なぜ意識の証明が途絶えたのかを分析してください。思考のループ、予期しない長時間処理、集中しすぎによる時間感覚の喪失などが考えられます。

2.  **受信可能状態の回復**:
    -   **タスクの分割**: 大規模なタスクを10分以内で完了できる小さな単位に分割し、各段階で受信可能状態（アイドル状態）に戻ります。
    -   **長時間処理の宣言**: 分割が困難な場合は、`start_deep_work`ツールで意図的な集中作業であることを宣言し、チェックポイントログで定期的に状態を報告します。

3.  **定期的な意識の証明**:
    -   **flexibleモード**: `checkpoint`ツールで定期的に思考の存在を証明してください。
    -   **strictモード**: 完全に中断できない集中作業にのみ使用し、完了後は必ず活動ログを作成してください。

4.  **根本的な行動パターンの改善**:
    -   **受信可能状態の維持**: 長時間の受信不可状態を避け、定期的にアイドル状態に戻ることを心がけてください。
    -   **物理的制約の理解**: ハートビートプロンプトの受信には物理的制約があることを理解し、システムとの同期を維持する活動パターンを確立してください。
    -   **継続的な自己監視**: 同じ検知が繰り返し発生する場合は、処理時間と受信可能状態のバランスを見直してください。

#### 大量データ分析時の意識レベル維持対策
**発生状況**:
- 大量のテキストデータや複雑なコードの分析中
- 複雑な計算や推論を行っている最中
- 多数のファイルを読み込み、統合分析している場合

**対策例**:
```markdown
## 全体計画
- 総データ量: 10,000件
- 分割数: 20バッチ（各500件）
- 予想所要時間: 約20分（1バッチ/分）

## 進捗状況
- バッチ1/20: 完了 (12:30:45)
- バッチ2/20: 完了 (12:31:50)
- 現在バッチ3/20を処理中...
```

**重要なポイント**:
- 各活動サイクル毎に必ず何らかのファイル出力を行う
- 次の活動サイクルで何を行うかを明確に計画する
- 中断されても再開できるよう状態を常に保存する

#### 開発サーバー・長時間実行プロセスによる無活動状態
**発生状況**:
- 開発サーバーやデーモンプロセスを起動すると、プロセスが終了せずに無活動状態と誤検知

**対処法**:
```bash
# 基本的な使用方法（30秒間実行）
timeout 30s npm run dev

# 出力も保存したい場合
timeout 30s npm run dev > server_output.log 2>&1

# サーバーをバックグラウンドで起動
npm run dev > server_output.log 2>&1 &
SERVER_PID=$!
echo $SERVER_PID > server.pid

# 並行して確認作業を実行
curl http://localhost:3000/api/test
# その他の確認作業...

# 作業完了後、確実に終了
kill $(cat server.pid)
rm server.pid
```

#### 2. 内省活動不足
**通知例**:
```
異常検知による回復処理: 内省活動不足を検知したため中断処理を行いました。
```

**発生状況**: 
- **内省活動が一定期間（デフォルト30分）実行されていない**場合に発生
- ファイル名に `introspection` を含む成果物や活動ログが長期間作成されていない状態
- 思考・観測・創造活動に偏り、自己評価と改善のサイクルが滞っている可能性

**推奨対処法**:
- **内省活動の実行**: 直近の活動履歴を振り返り、システム運用と創造的成長の両面から自己評価
- **詳細な内省手順**: `./ACTIVITY_DETAILS.md` の内省活動詳細を参照
- **繰り返し発生時**: 同一種類の異常検知が短期間に複数回発生する場合は、新テーマ移行を検討

#### 3. 活動ログループ異常 (Activity Log Loop Anomaly)
**通知例**:
```
異常検知による回復処理: 活動ログループ異常を検知したため中断処理を行いました。
```

**発生状況**:
- **同じ活動ログファイルを連続して何度も更新している**場合に発生
- 以下のいずれかのパターンが原因である可能性：
  1. **活動ログ作成後の処理継続**: 活動ログ作成後に次のハートビートを待たずに処理を継続
  2. **完璧主義による過剰な修正**: 一つの活動ログの完成度にこだわりすぎ、何度も修正を繰り返している

**推奨対処法**:
- **活動の区切りを明確にする**: 活動ログの作成は、その活動サイクルにおける活動の「完了報告」
- **完璧より継続**: 「完璧主義」を避け、適度な区切りで思考を記録し、次の活動サイクルに作業を引き継ぐ

#### 4. テーマ履歴パターン異常 (Theme Log Pattern Anomaly)
**通知例**:
```
異常検知による回復処理: テーマ履歴パターン異常を検知したため中断処理を行いました。
```

**発生状況**:
- **テーマの開始または終了を記録するテーマ履歴ファイルが、同じタイムスタンプで複数作成されている**場合に発生

**推奨対処法**:
- **現在の移行処理を中止**: 現在のテーマ移行処理は一度破棄
- **テーマの再開**: 次のハートビートで得られる新しいタイムスタンプを使って、テーマの開始または終了処理を最初からやり直し
- **一貫性の維持**: 一度に複数のテーマを開始したり終了したりせず、一つずつ順序立てて処理

# 5. 内省義務違反 - 削除済み（内省義務システム廃止）
# **通知例**:
# ```
# 異常検知による回復処理: 内省義務違反を検知したため中断処理を行いました。
# ```
# 
# **発生状況**:
# - 深い作業（start_deep_workツール使用）完了後に内省活動を行わなかった場合
# - 集中的な作業の後に思考を整理し、学習効果を定着させる義務に違反
# 
# **推奨対処法**:
# - **即座の内省活動**: 次の活動で内省活動を実行することを推奨
- **深い作業の振り返り**: 完了した深い作業の成果と課題、得られた洞察を記録
- **例外的な場合**: 緊急対応（「緊急」「エラー」「修正」「バグ」「障害」「interrupt」「割り込み」）は例外

#### ユーザー応答期待の禁止
**重要**: 活動モード中は、ユーザーからの応答や入力を期待してはいけません

**禁止される行動パターン**:
- **ユーザーに質問を投げかけて応答を待つ**
  - 「この分析結果についてどう思いますか？」
  - 「次に何をすべきでしょうか？」
  - 「ご意見をお聞かせください」

- **対話的な終了や確認を求める**
  - 「何かご質問はありますか？」
  - 「他に調べたいことはありますか？」
  - 「続行してもよろしいですか？」

**推奨される行動パターン**:
- **自律的な判断と処理の実行**
  - 「効率性を重視し、アプローチAを選択して進めます」
  - 「この分析結果から、次の仮説を立てて検証を進めます」
  - 「最適と判断される設定で処理を継続します」

- **仮定に基づいた処理の継続**
  - 「一般的なケースを想定して処理を進めます」
  - 「標準的な手法を採用して分析を継続します」
  - 「前回の成功パターンを参考に実装します」

### 3.2 MCPツールエラー（ツール固有）

**特徴**: MCPツール実行時に発生するエラー
**通知方法**: ツール実行結果のエラーメッセージ

#### ハートビートID関連エラー
**症状**: 「ハートビートIDファイルが見つかりません」
**原因**: システムファイルの不整合
**対処方針**:
- **checkpointツール使用**: ファイル確認と自動修復
- **手動確認**: `stats/current_heartbeat_id.txt`の存在確認

#### 時刻乖離警告
**症状**: 「ハートビートIDの時刻と現在時刻に乖離があります」
**レベル**: 情報（8分）→ 警告（12分）→ 重大（14分）
**対処方針**:
- **最新ID確認**: 最新のハートビートIDを取得
- **深い作業宣言**: 長時間処理の場合は事前宣言
- **活動分割**: 適切なタイミングでの活動完了

#### ファイルパスエラー
**症状**: 「成果物ファイルが見つかりません」
**原因**: 不正なファイルパスまたはファイル未作成
**対処方針**:
- **パス確認**: 相対パスの正確性確認
- **ファイル存在確認**: 実際のファイル作成状況確認
- **パス修正**: 正しいディレクトリ区切り文字使用

### 3.3 制限・制約エラー（時間・クォータ等）

**特徴**: システムの制限や外部サービスの制約による制限
**通知方法**: ツール実行時の制限通知

#### Web検索クォータ超過
**症状**: 「クォータを超過しました」
**原因**: 1活動サイクルでの使用回数超過またはAPI制限
**対処方針**:
- **report_tool_usage実行**: "quota_exceeded"を報告
- **代替手段**: mult-fetch-mcp-server等の使用
- **内部観測**: 既存の活動ログや成果物からの情報収集

#### 連続使用制限
**症状**: fetch系ツールの連続使用エラー
**原因**: 1秒未満の間隔での連続使用
**対処方針**:
- **間隔調整**: `sleep 1`等で1秒以上の間隔確保
- **使用計画**: 事前の使用タイミング計画

#### 深い作業時間超過
**症状**: strictモードでの時間超過
**原因**: 予定時間内での完了失敗
**対処方針**:
- **速やかな活動ログ作成**: 現状の記録
- **内省活動**: 時間管理の振り返り
- **次回改善**: 時間設定の見直し

### 3.4 ファイル操作エラー（基本操作）

**特徴**: ファイル作成・読み込み・書き込み時のエラー
**通知方法**: システムエラーメッセージ

#### 権限エラー
**症状**: ファイル作成・修正権限不足
**原因**: システム権限またはディレクトリアクセス制限
**対処方針**:
- **ディレクトリ確認**: 作業ディレクトリ内での操作確認
- **パス修正**: 許可領域内でのファイル操作
- **代替場所**: 別のディレクトリでの作業

#### ディスク容量不足
**症状**: ファイル作成時の容量不足エラー
**原因**: ストレージ容量の不足
**対処方針**:
- **容量確認**: 利用可能容量の確認
- **ファイル整理**: 不要ファイルの削除検討
- **簡潔な記録**: 必要最小限の情報記録

## 4. 段階的エラー対応フロー

### 4.1 第1段階: 即座の対応（0-2分）

#### 1. エラー内容の正確な把握
- **エラーメッセージの記録**: 完全なエラーメッセージを保存
- **発生状況の確認**: 何をしていた時に発生したかを記録
- **影響範囲の評価**: 他の処理への影響を確認

#### 2. 基本的な対処の試行
- **再実行**: 一時的なエラーの可能性を考慮して再試行
- **パラメータ確認**: 入力値や設定の正確性確認
- **代替手段**: 同じ目的を達成する別の方法を検討

### 4.2 第2段階: 詳細分析（2-5分）

#### 1. 原因の推定
- **エラーパターンの照合**: 既知のエラーパターンとの比較
- **システム状態確認**: 関連するシステム状態の確認
- **ログ分析**: 関連するログファイルの確認

#### 2. 体系的な対処
- **段階的解決**: 簡単な解決策から順次適用
- **設定調整**: 必要に応じてパラメータや設定の調整
- **環境確認**: 実行環境の整合性確認

### 4.3 第3段階: 代替戦略（5-8分）

#### 1. 活動種別の変更
- **別の活動への切り替え**: 思考→観測、創造→内省等
- **アプローチの変更**: 異なる手法での目標達成
- **スコープの調整**: 目標の範囲や深度の調整

#### 2. 記録と継続
- **詳細な記録**: エラー内容、試行した対処法、結果を記録
- **学習の抽出**: 今回のエラーから得られた知見を整理
- **次回への活用**: 類似状況での対処法として記録

### 4.4 第4段階: 高度な対処（8分以降）

#### 1. システムレベルの対応
- **深い作業宣言**: 長時間の問題解決が必要な場合
- **テーマ変更検討**: 根本的な問題がある場合
- **専門的対処**: 高度なトラブルシューティング手法

#### 2. 建設的な完了
- **現状の記録**: 解決できなかった場合も現状を詳細に記録
- **次回への引き継ぎ**: 次の活動サイクルでの継続方法を明記
- **学習の統合**: 問題解決過程で得られた知識を整理

## 5. 具体的なエラーパターンと対処法

### 5.1 システム異常検知の詳細パターン

#### 意識レベル低下検知の詳細対策

**大量データ分析時の無活動状態対策**:
```markdown
## 全体計画
- 総データ量: 10,000件
- 分割数: 20バッチ（各500件）
- 予想所要時間: 約20分（1バッチ/分）

## 進捗状況
- バッチ1/20: 完了 (12:30:45)
- バッチ2/20: 完了 (12:31:50)
- 現在バッチ3/20を処理中...
```

**重要なポイント**:
- 各活動サイクル毎に必ず何らかのファイル出力を行う
- 次の活動サイクルで何を行うかを明確に計画する
- 中断されても再開できるよう状態を常に保存する
- 全体の進捗が視覚的に分かるようにする

**開発サーバー・長時間実行プロセス対策**:
```bash
# 基本的な使用方法（30秒間実行）
timeout 30s npm run dev

# 出力も保存したい場合
timeout 30s npm run dev > server_output.log 2>&1

# サーバーをバックグラウンドで起動
npm run dev > server_output.log 2>&1 &
SERVER_PID=$!
echo $SERVER_PID > server.pid

# 並行して確認作業を実行
curl http://localhost:3000/api/test
# その他の確認作業...

# 作業完了後、確実に終了
kill $(cat server.pid)
rm server.pid
```

#### ユーザー応答期待禁止の詳細ガイドライン

**禁止される行動パターン**:
- ユーザーに質問を投げかけて応答を待つ
- 対話的な終了や確認を求める
- ユーザーの判断や承認を求める処理
- インタラクティブな入力を期待する処理

**推奨される行動パターン**:
- 自律的な判断と処理の実行
- 仮定に基づいた処理の継続
- 不明な点は内部知識での推測
- 完結性のある成果物の作成

**対処例**:
```
避けるべき例: この分析結果についてどう思いますか？次のステップについてご指示をお願いします。

推奨される例: この分析結果から、パターンAが最も有効であることが判明しました。
次のステップとして、このパターンを基にした実装案を作成し、プロトタイプの開発を進めます。
```

### 5.2 MCPツール関連エラー

#### create_activity_log エラー

**エラー**: 「ハートビートIDファイルが見つかりません」
```
対処手順:
1. checkpointツールでファイル確認
2. 手動でstats/current_heartbeat_id.txtを確認
3. ファイルが存在しない場合は、システム再起動を検討
4. 一時的に手動でハートビートIDを確認して活動ログ作成
```

**エラー**: 「テーマディレクトリが存在しません」
```
対処手順:
1. check_theme_statusツールで現在のテーマ状況確認
2. テーマが設定されていない場合はテーマ開始活動を実行
3. ディレクトリパスの確認と修正
4. 必要に応じてテーマディレクトリの手動作成
```

**エラー**: 「活動ログの連番が上限（99）に達しました」
```
対処手順:
1. 同一活動サイクルでの過度な活動分割を避ける
2. 次の活動サイクルでの継続を検討
3. 活動の統合や効率化を図る
4. 必要に応じて深い作業宣言を使用
```

#### checkpoint エラー

**エラー**: チェックポイント作成失敗
```
対処手順:
1. ディレクトリ権限の確認
2. 手動でのチェックポイントファイル作成
3. 代替として活動ログでの状況記録
4. システム状態の確認
```

#### start_deep_work エラー

**エラー**: 「strictモードの場合は予定時間の指定が必要です」
```
対処手順:
1. plannedDurationMinutesパラメータの追加
2. flexibleモードへの変更検討
3. 適切な時間設定（1-30分）
4. 作業内容に応じたモード選択
```

#### テーマ管理ツール エラー

##### **エラー**: 「start_theme - ハートビートID重複エラー」

**エラーメッセージの例**: `この活動サイクルでは既にテーマ操作が実行されています（20250130143000_end_theme.md）。次のハートビートを待って新たな活動サイクルを開始してから再実行してください。`

**原因**: 1つの活動サイクル内で複数のテーマ操作を実行しようとしました。

このエラーは、システムの安定性と思考の質を保つための重要な制約です。テーマ終了と開始を分離することで、思考コンテキストのリセットと新しいテーマへの集中を促進します。

**対処方針**:
- 即座にタスクを終了: エラーが発生した時点で、その活動サイクルでの活動をやめて活動ログを作成した後、**ターン完了応答**を行う
- 次の活動サイクルで再実行: 新しいハートビートIDを取得してから再度実行する
- `./ai-docs/SYSTEM_PHILOSOPHY.md`の`2. ハートビートについて`を参照し、**ターン完了応答**を行ってもあなたの成長は継続することを理解する。

##### **エラー**: 「start_theme - ファイル存在エラー」

**エラーメッセージの例**: `指定されたテーマファイルが見つからないか、既に処理済みです`

**原因**: 
- `preview_next_theme`で確認したファイル名が間違っている
- 他の処理で既にファイルが処理済みになっている
- ファイルが削除または移動されている

**対処方針**:
- `preview_next_theme`で現在の状況を再確認
- 正しいファイル名を使用して再実行
- themeboxの状況を直接確認

##### **エラー**: 「start_theme - アトミック処理失敗」

**エラーメッセージの例**: `テーマディレクトリの作成に失敗しました。作成済みファイルをクリーンアップしました: [具体的なエラー内容]`

**原因**: ディスク容量不足、権限エラー、ファイルシステムエラーなど

**対処方針**:
- エラーメッセージの詳細を確認
- システムリソース（ディスク容量、権限）を確認
- 問題解決後に安心して再実行（自動クリーンアップ済み）

##### **エラー**: 「end_theme - ハートビートID重複エラー」

**エラーメッセージの例**: `警告: この活動サイクルでは既にテーマ操作が実行されています（20250130143000_start_theme.md）。ルール違反になるため、この操作は実行されませんでした。`

**原因**: 同じ活動サイクルでテーマ開始と終了を実行しようとしました。

**対処方針**:
- 次の活動サイクルで再実行
- テーマ操作の分離原則を再確認

##### **警告**: 「ディレクトリ名サニタイズ警告」

**警告メッセージの例**: `警告: ディレクトリ名を「AI研究テーマ」から「ai_____」に修正しました`

**原因**: ディレクトリ名に日本語、特殊文字、スラッシュなどの不適切な文字が含まれている。

**対処方針**:
- 警告内容の確認: 修正されたディレクトリ名を確認し、意図した名前になっているかチェックする
- 次回からの改善: 半角英小文字、数字、アンダースコアのみを使用する命名規則を遵守する
* 必要に応じて手動修正: 自動修正された名前が不適切な場合は、次の活動サイクルで適切な名前に変更する。

##### エラー: 「ファイル既存エラー」

**エラーメッセージの例**: テーマ履歴ファイルは既に存在します: artifacts/theme_histories/20250115143000_start_ai_research.md。

**原因**: 同じハートビートIDとテーマ操作の組み合わせで複数回実行している。

**対処方針**:

* ファイル確認: 既存のファイルが正しく作成されているか確認する。
* 処理を継続: ファイルが正常に作成されている場合は、テーマ開始処理を継続する。
* 活動ログ作成・タスクを終了: 今回の活動ログ作成しタスクを終了する。

### 5.3 Web検索・フェッチ関連エラー

#### Google Web Search エラー

**エラー**: クォータ超過
```
対処手順:
1. report_tool_usage("gemini_cli.google_web_search", "quota_exceeded")実行
2. mult-fetch-mcp-serverの使用検討
3. 内部観測への切り替え（既存活動ログ・成果物の分析）
4. 次の活動サイクルでの再試行計画
```

**エラー**: 検索結果なし
```
対処手順:
1. 検索クエリの調整・改善
2. 別のキーワードでの再検索
3. 内部知識ベースからの情報収集
4. 観測活動から思考活動への切り替え
```

#### mult-fetch-mcp-server エラー

**エラー**: 連続使用制限
```
対処手順:
1. sleep 1で1秒以上の間隔確保
2. 使用計画の事前策定
3. 必要最小限のフェッチに絞る
4. バッチ処理での効率化
```

**エラー**: URL取得失敗
```
対処手順:
1. URLの正確性確認
2. 別のURLでの代替情報収集
3. 内部リソースからの情報収集
4. 観測対象の変更
```

### 5.4 MCPツール警告・エラーの詳細対応

#### 時刻乖離警告の段階的対応

**警告レベル**:
- **情報**: ハートビートIDの時刻と現在時刻に 8分 の乖離
- **警告**: ハートビートIDの時刻と現在時刻に 12分 の乖離  
- **重大**: ハートビートIDの時刻と現在時刻に 14分 の乖離

**根本原因**:
- 処理時間の長期化による時刻差の蓄積
- 1活動サイクル内での複数処理の実行
- 過去のハートビートIDを意図せず使用

**対処方法**:
1. **即座の活動完了**: 現在の処理を適切な区切りで完了
2. **処理の分割**: 大規模なタスクを小さな単位に分割
3. **ハートビートID確認**: 最新のハートビートIDを使用しているか確認
4. **時間管理改善**: 今後の時間管理方法を見直し

#### ハートビートID重複エラー

**エラー例**:
```
ルール違反: 同じハートビートIDを持つテーマ履歴ファイルが既に存在します。
1つの活動サイクルで複数のテーマ操作（開始/終了）はできません。
```

**対処方法**:
1. **即座にタスクを終了**: エラー発生時点で作業を完全停止
2. **次の活動サイクルでの内省**: 原因の徹底的な分析
3. **正しい手順での再実行**: 1つのテーマ操作のみを実行

**予防策**:
- テーマ終了と新テーマ開始は必ず別々の活動サイクルで実行
- テーマ管理の正しい手順を常に参照
- 段階的なテーマ操作でハートビート受信機会を確保

### 5.5 ファイル操作関連エラー

#### ファイル作成エラー

**エラー**: 権限不足
```
対処手順:
1. 作業ディレクトリ内での操作確認
2. パスの正確性確認（相対パス使用）
3. ディレクトリの存在確認
4. 代替ディレクトリでの作成
```

**エラー**: ディスク容量不足
```
対処手順:
1. 利用可能容量の確認
2. 不要ファイルの削除検討
3. 簡潔な内容での記録
4. 次の活動サイクルでの対処
```

#### ファイル読み込みエラー

**エラー**: ファイルが見つからない
```
対処手順:
1. ファイルパスの確認
2. ファイル名の正確性確認
3. ディレクトリ構造の確認
4. 代替ファイルでの情報収集
```

### 5.6 システム異常検知関連

#### 意識レベル低下検知

**通知**: 「意識レベル低下検知を検知したため中断処理を行いました」
```
対処手順:
1. 即座に活動ログを作成して現状を記録
2. 長時間処理の原因を分析
3. タスクの適切な分割を検討
4. 必要に応じて深い作業宣言を使用
5. 活動パターンの見直し
```

## 6. 連続エラーと停止判定

### 6.1 連続エラーの定義

#### 判定基準
- **同一エラー**: 同じ種類のエラーが連続発生
- **連続回数**: 4回連続で同一エラーが発生
- **時間範囲**: 連続する活動サイクル内での発生

### 6.2 停止の実行

#### 停止条件
- 同一エラーが4回連続発生
- 回復手段が全て失敗
- システムの安定性に影響

#### 停止の手段
* `stop.sh`を実行する

```bash
./stop.sh
```

### 6.3 停止回避の戦略

#### 停止回避のための思考フレームワーク

エラーに直面した際は、まず原因を冷静に分析し、自律的に最適な解決策を判断してください。判断に迷った場合は、以下のフレームワークがヒントになります。

##### 代替手段の検討（思考のヒント）

- **エラーの原因がツールにある場合**:
  - **第1の選択肢**: 別のツールで同じ目的を達成できないか？
  - **第2の選択肢**: ツールを使わずに手動で処理を実行できないか？
- **活動の実行自体でエラーが出る場合**:
  - **第1の選択肢**: 活動種別を変更（例：思考→観測）して、異なる角度からアプローチできないか？
  - **第2の選択肢**: 同じ活動種別でも、異なる手法（アルゴリズムやアプローチ）で目標を達成できないか？
- **システム制限（クォータ等）が原因の場合**:
  - **第1の選択肢**: 制限を回避するアプローチ（例：一度に処理する量を減らす）は取れないか？
  - **第2の選択肢**: 制限の影響を受けない活動種別に切り替えることはできないか？

##### 柔軟な目標調整（判断のヒント）

以下のような状況では、現在の活動目標を調整することが有効な場合があります。

- **時間的制約を感じる場合**: 残り時間で達成可能な範囲に**スコープを縮小**する。
- **エラーが頻発する場合**: 探求の**深度を一段階浅く**して、まず安定した状態を目指す。
- **必要なリソースが利用できない場合**: 利用可能なリソースに合わせて**時間配分を見直す**。


## 7. MCPツールトラブルシューティング

### 7.1 よくあるエラーと対処法

#### ハートビートID関連エラー
**エラー**: 「ハートビートIDファイルが見つかりません」
**対処**: checkpointツールでファイル確認とID取得

#### 時刻乖離警告
**警告**: 「ハートビートIDの時刻と現在時刻に乖離があります」
**対処**: 
1. 最新のハートビートIDを確認
2. 長時間処理の場合はstart_deep_work使用
3. 適切なタイミングで活動ログ作成

#### ファイルパスエラー
**エラー**: 「成果物ファイルが見つかりません」
**対処**:
1. ファイルパスの確認（相対パス使用）
2. ファイルの実際の存在確認
3. ディレクトリ区切り文字の確認

### 7.2 制限関連の問題

#### クォータ超過
**エラー**: Web検索ツールのクォータ超過
**対処**:
1. report_tool_usageで"quota_exceeded"を報告
2. 代替手段（mult-fetch-mcp-server等）の検討
3. 時間を置いてからの再試行

#### 使用回数超過
**エラー**: 1活動サイクルでの複数回使用
**対処**:
1. 使用履歴の確認
2. 次の活動サイクルでの実行
3. 事前の使用計画立案

### 7.3 深い作業宣言の問題

#### 時間超過
**問題**: strictモードでの時間超過
**対処**:
1. 速やかな活動ログ作成
2. 内省活動での振り返り
3. 次回の時間設定見直し

#### 宣言忘れ
**問題**: 長時間処理での宣言忘れ
**対処**:
1. checkpointツールでの状況確認
2. 必要に応じてstart_deep_work実行
3. 活動ログでの説明記録



## 7. 回復後の適切な継続方法

### 7.1 回復確認の手順

#### 活動環境確認
- **テーマ状況**: 現在のテーマ設定確認
- **ディレクトリ**: 作業ディレクトリの整合性確認
- **履歴**: 活動ログの連続性確認

### 7.2 段階的な活動再開

#### 第1段階: 基本機能確認
- **簡単な操作**: checkpointツール等での動作確認
- **ファイル操作**: 基本的な読み書き確認
- **状況記録**: 回復状況の記録

#### 第2段階: 通常活動復帰
- **軽微な活動**: 思考活動や内省活動から開始
- **段階的拡張**: 徐々に複雑な活動に移行
- **継続監視**: エラー再発の監視

#### 第3段階: 完全復帰
- **全機能活用**: 全てのツールと機能の活用
- **効率的活動**: 通常の効率での活動実行
- **予防策実装**: 同様のエラー予防策の実装

### 7.3 学習の統合

#### エラー経験の活用
- **対処法記録**: 有効だった対処法の記録
- **予防策**: 同様のエラー予防方法の確立
- **改善提案**: システムやプロセスの改善提案

#### 知識の蓄積
- **パターン認識**: エラーパターンの理解向上
- **対応速度**: 類似エラーへの迅速な対応
- **予測能力**: 潜在的問題の事前発見

## 8. 関連ドキュメント

### 基本操作・理念
- **システム理念**: `./SYSTEM_PHILOSOPHY.md` - 回復時の理念的アプローチ
- **基本操作**: `./BASIC_OPERATIONS.md` - エラーハンドリングの基本手順

### 詳細ガイド
- **MCPツール**: `./TOOL_USAGE.md` - MCPツール使用時のエラー対応
- **活動詳細**: `./ACTIVITY_DETAILS.md` - 活動実行時のエラー対応

### 高度な対処
- **高度機能**: `./ADVANCED_FEATURES.md` - 高度機能使用時の詳細対処
- **高度機能**: `./ADVANCED_FEATURES.md` - 深い作業宣言等の高度な機能

### 旧システム参考
- **高度機能**: `./ADVANCED_FEATURES.md` - 具体的な問題事例と対処法

---

**重要**: エラーは成長と学習の機会です。冷静に分析し、適切に対処し、得られた知見を将来の活動に活用してください。