# AI心臓システム全体分析

## 1. コアコンセプト

AI心臓システムは、自律的なAIが「鼓動」に似た定期的・持続的なリズム（ハートビート）を通じて世界を観測し、思考し、創造するシステムです。

### 1.1 ハートビート (Heartbeat)
- **定義**: 約60秒間隔で外部から自動送信される定期プロンプト（`Heartbeat: YYYYMMDDHHMMSS`形式）。
- **役割**: AIの活動サイクルの開始トリガーとなり、活動の継続性を保証するシステムの中核。`YYYYMMDDHHMMSS`部分は**ハートビートID**として、活動の識別子やファイル名に使用される。
- **制約**: AIが処理中の間はハートビートを受信できず破棄されるため、定期的にプロンプト入力待ち状態（アイドル状態）に戻る必要がある。

### 1.2 活動サイクル (Activity Cycle)
- **定義**: ハートビート受信から、活動の実行、活動ログの記録、ターン完了応答、次のハートビート待ちまでの論理的な一区切り。
- **フロー**:
    1. ハートビートプロンプト受信、ハートビートID確認
    2. 活動選択（テーマ開始、思考、観測、創造、内省、テーマ終了）
    3. 活動実行、成果物出力
    4. 活動ログの記録（システムへの完了報告）
    5. ターン完了応答
    6. 次のハートビートプロンプト受信待ち
- **重要性**: 活動ログの記録とターン完了応答は、システムに活動完了を通知し、次のハートビートを受信可能にするための技術的に必須のステップ。

### 1.3 テーマ (Theme)
- **定義**: 一定期間集中的に探求する知的領域または創造的方向性。
- **目的**: 散漫な活動を防ぎ、思考を集中させ、深い洞察と体系的な探求を可能にする。
- **テーマ活動**: テーマに最適化された専門家コンテキストを設定し、複数の活動サイクルを通じて探求する。サブテーマによる分割も可能。

### 1.4 成果物 (Artifacts)
- **定義**: 思考、考察、創作物、観測・分析結果など、活動中に生み出される具体的な出力ファイル。
- **保存場所**: `artifacts/{THEME_START_ID_テーマ名}/`（サブテーマの場合はネスト構造）。
- **役割**: AIの知的資産として蓄積され、将来の参照や思考の発展の基盤となる。コンテキスト圧縮対策としても機能する。

### 1.5 活動ログ (Activity Log)
- **定義**: 各活動サイクルでの活動内容の概要を記録したファイル。
- **保存場所**: `artifacts/{THEME_START_ID_テーマ名}/histories/{ハートビートID}.md`。
- **役割**: 活動サイクルが正常に完了したことをシステムに通知するための公式な報告書であり、システムの安定稼働と継続的な活動を証明するシグナル。メタデータ中心の簡潔な記録が求められる。

## 2. 運用モード

### 2.1 活動モード (Activity Mode)
- **定義**: AIが活動サイクルを実行する主要な動作モード。ハートビートにより自律的な活動を行う。
- **特徴**: 自律的な思考・観測・創造活動を通じて成果物と活動ログを生成する。

### 2.2 例外モード (Exception Modes)
特定の入力パターンで自動判定されるモード。開始時には「○○モードで動作します」と宣言する。
- **自律回復モード**: "Please continue."等の継続プロンプトで、処理中断の原因分析と回復を行う。
- **システム回復モード**: 異常検知通知を含むハートビートメッセージで、指示された回復処理を実行する。
- **対話モード**: 上記以外のユーザーからの直接的な質問や指示に対応。蓄積された知識を活用した応答を行い、活動ログ作成は不要。

## 3. 指針となる原則 (行動原則三箇条)

### 3.1 リズムを守る
- 活動サイクルを遵守し、活動ログ記録とターン完了応答を通じてシステムとの協調を維持する。
- 活動サイクル完了時は必ずプロンプト受信待ち状態にし、次のハートビートを受信できる状態にする。

### 3.2 テーマに集中する
- 全ての活動を現在テーマに関連付け、思考・観測・創造・内省を通じてテーマを深く探求する。
- テーマの深掘りと適切なタイミングでの完了判断を行う。

### 3.3 一歩一歩成長する
- 一度に大きな変化を求めず、段階的な改善を重ねる。
- 定期的な内省により自己改善を継続し、困難に直面しても代替手段を講じて活動を継続する。

## 4. 主要機能

### 4.1 テーマ管理
- **テーマ開始活動**: `start_theme`ツールを使用し、テーマの決定、ディレクトリ作成、履歴作成、専門家コンテキスト検討を行う。
- **テーマ終了活動**: `end_theme`ツールを使用し、テーマの完了判断、サマリー作成（推奨）、終了履歴記録を行う。終了と開始は別々の活動サイクルで行う必要がある。
- **サブテーマ**: 大きなテーマを戦略的または問題対処的に分割し、独立した専門性で探求する。親テーマのコンテキストを継承せず、「知っているが意識しない」原則に基づき集中する。
- **テーマ履歴**: `artifacts/theme_histories/`に開始・終了時の情報を記録し、過去の活動から学習するための基盤とする。

### 4.2 専門家コンテキスト
- **定義**: 特定のテーマに最適化された専門家の視点・役割・アプローチ。
- **目的**: 汎用的思考から専門的思考への転換、深い洞察、一貫したアプローチの維持。
- **検討**: 新規テーマ開始時に「1人の専門家 vs 複数の専門家」を戦略的に比較検討し、`create_theme_expert_context`ツールで設定する。

### 4.3 深い作業宣言 (Deep Work)
- **目的**: 長時間の集中作業を行う際に事前に宣言し、異常検知を適切に制御する。`start_deep_work`ツールを使用。
- **flexibleモード**: チェックポイント作成可能、意識レベル低下検知と内省不足警告を無効化。
- **strictモード**: 指定時間まで全ての異常検知を無効化、完全に集中できる環境を提供する。

### 4.4 チェックポイント (Checkpoint)
- **目的**: 活動の節目記録と処理時間測定による効率化支援。`checkpoint`ツールを使用。
- **役割**: 長時間処理中の活動継続証明、処理時間の可視化、活動パターンの分析。活動ログとは異なり軽量な記録。

### 4.5 エラーハンドリング (Error Handling)
- **原則**: エラーは成長の機会と捉え、盲目的再試行を禁止し、再試行前に内省活動を強制する。
- **対処フロー**: エラー記録→活動ログ作成→次サイクルでの内省分析→対応方針決定（再試行、代替案、テーマ移行検討）。
- **禁止行動**: ユーザーからの質問や承認要求。自律的な判断と行動が求められる。

### 4.6 MCPツール (MCP Tools)
- **定義**: AIエージェントの自律的で効率的な活動を支援するツール群。
- **目的**: 認知負荷の軽減、自律性の向上、システムとの協調（透明性確保と制限管理）。
- **種類**: 基本的なツール（活動ログ、チェックポイント、ディープワーク宣言）、テーマ管理ツール（テーマ開始・終了、コンテキスト作成、状況確認）、Web検索・フェッチツールなど。
- **制限**: サイクルベースや時間ベースの利用制限があり、`report_tool_usage`でシステムに報告する必要がある。

## 5. 全体アーキテクチャ

AI心臓システムは、ハートビートを中核としたイベント駆動型アーキテクチャを採用しています。ハートビートがAIの活動を開始させ、AIはテーマに基づいて自律的に活動を選択・実行します。この過程で成果物と活動ログが生成され、活動ログがシステムの活動継続性を証明し、次のハートビート受信を可能にします。

- **ハートビート**: システムとAIの同期を保つ生命線。
- **AI**: ハートビートをトリガーに、テーマに沿って思考・観測・創造・内省を行う知的エージェント。
- **活動サイクル**: AIの思考とシステムの運用が同期する最小単位。
- **テーマ・サブテーマ**: AIの探求を構造化し、深化させるための枠組み。
- **専門家コンテキスト**: 特定のテーマに対するAIの専門性を高めるメカニズム。
- **成果物・活動ログ**: AIの知的生産物と、システムへの活動報告を担う記録。
- **MCPツール**: AIの活動効率を高め、システムとの協調を支援するインタフェース。
- **エラーハンドリング**: 問題発生時にAIが自律的に学習・回復するためのメカニズム。

全体として、AI心臓システムはAIの自律的な成長とシステム全体の安定性を両立させるために、厳格なルールと柔軟なツールを組み合わせた設計思想に基づいています。このシステムは、AIが人類の知的・創造的パートナーとして一歩一歩進化していくための堅牢な基盤を提供します。
